# Capture Attacks script
capture_attacks.py is used for defining network attacks and capturing resulting network traffic.

Runs commands defined in YAML configuration file and captures the resulting network traffic into PCAP files.
Optional VM configuration.
Writes logs for every command.

This script is designed to be executed in virtual environment generated by Vagrant.
The host executing this script is called attacker.
Other hosts in network are called victims.

Elevated privileges are necessary due to tshark capture.

Use: $ `sudo python capture_attacks.py`


### Requirements
These are necessary to be installed on host executing this script:
- [Paramiko](http://www.paramiko.org/) - Python support module for SSH
- [Tshark](https://www.wireshark.org/docs/man-pages/tshark.html) - Capture and analyse network traffic.


### Options
```
usage: capture_attacks.py [-h] [-c COMMANDFILE] [-d CAPTUREDIRECTORY]
                          [-i NETWORKINTERFACE] [-t TIMEDELAY]

optional arguments:
  -h, --help
                        Show this help message and exit.
  -c COMMANDFILE, --commandfile COMMANDFILE
                        Path to the commands configuration file.
  -d CAPTUREDIRECTORY, --capturedirectory CAPTUREDIRECTORY
                        Directory for captured traffic.
  -i NETWORKINTERFACE, --networkinterface NETWORKINTERFACE
                        Network interface used to capture network traffic.
  -t TIMEDELAY, --timedelay TIMEDELAY
                        Additional time for wandering packets [seconds].
```


### Configuration
Define a list of attacks to be captured. Configuration is defined using YAML format.

One task consists of:
- `victims`: Configuration for victim VMs. Optional. If provided, `ip` and `configure` are mandatory.
    - `ip`: IP address of victim VM.
    - `configure`: Command to configure the VM.
- `attacker`: Definition of attacker VM. This is the host the script is run on. Mandatory.
    - `configure`: Command to configure the VM. Optional.
    - `filter`: Filter used in packet filtering during network traffic capture. See [Wireshark CaptureFilters](https://wiki.wireshark.org/CaptureFilters). Optional.
    - `command`: Command that is executed. Its resulting network traffic is captured. Mandatory.

Configuration example:
```yaml
---

- victims:
    - ip: 192.168.0.101
      configure: bash /vagrant/config/config_victim_101.sh
    - ip: 192.168.0.102
      configure: bash /vagrant/config/config_victim_101.sh
  attacker:
    configure: bash /vagrant/config/config_attacker.sh
    filter:  not icmp
    command: nmap -sW 192.168.0.101 -v
```

### Default login credentials
If victim configuration is provided, script uses SSH to connect to victim VMs.
- login: vagrant
- password: vagrant


### Output
For every item in the list defined in command file this is generated:
- **PCAP file** - Contains captured network traffic. Filtered using `filter` if provided.
- **Command log** - Contains standard output of the command.
- **Error command log** - If error occured during command execution, this file contains error message.
- If applicable, error and configuration logs of attacker and victim VMs are saved in _./config/_ directory.

Filename format: `<timestamp>__<command>.<file extension>`
or `<timestamp>__<command>__<configuration describtion>.<file extension>`

Characters not supported by OS (`@ #$%^&*<>{}:|;'\"/`) are replaced by '_' in filenames.


 
### Examples
- $ `sudo python capture_attacks.py`
Reads command configuration from file */vagrant/cmd.yaml*.
Captures network traffic on network interface *eth1*.
Saves resulting PCAP files and logs into */vagrant/capture/*.
After executing command, waits 3 second (time delay) before finishing capture.
This can be used for unreliable network simulation.

- $ `sudo python capture_attacks.py -c '/vagrant/cmd.yaml' -d '/vagrant/capture/' -i 'eth1' -t 3`

